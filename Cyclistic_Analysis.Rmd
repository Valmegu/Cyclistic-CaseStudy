---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.18.1
  kernelspec:
    display_name: R
    language: R
    name: ir
---

# Tarea final: Google Data Analytics

<!-- #region -->
Caso de estudio: **Cyclistic**
Cyclistic es una empresa **ficticia** que opera un sistema de bicicletas compartidas en Chicago, con m√°s de 5.000 bicicletas y 600 estaciones. Los usuarios pueden alquilar bicicletas en una estaci√≥n y dejarlas en otra dentro de la ciudad.
Existen dos tipos de usuarios:
Casuales, que alquilan por viaje.


Miembros, que acceden al sistema mediante una suscripci√≥n anual.

<!-- #endregion -->

Para realizar este proyecto se seguiran las faces del an√°lisis descritas en el curso de Google Data Analytics

1. ASK
2. PREPARE
3. PROCESS
4. ANALYZE
5. SHARE
6. ACT


# Fase: Ask
**Problema a resolver**
Determinar qu√© diferencias existen entre los usuarios casuales y los miembros, con el fin de comprender qu√© podr√≠a motivar a los casuales a convertirse en miembros.

**Pregunta gu√≠a**
¬øEn qu√© se diferencia el comportamiento de viaje entre los usuarios casuales y los miembros?

**Objetivo del an√°lisis**
Identificar patrones en los datos que permitan generar recomendaciones de marketing efectivas para incrementar el n√∫mero de miembros.

**Tarea empresarial**
Analizar los registros de viajes de los √∫ltimos 12 meses para detectar diferencias clave en el comportamiento de ambos tipos de usuarios, que puedan orientar una estrategia para convertir usuarios casuales en suscriptores.

**Stakeholders**

* Equipo ejecutivo de Cyclistic
* Directora de Marketing: Lily Moreno


<!-- #region -->
# Fase: Prepare

**Problema a resolver**

Verificar que los datos cumplen con el est√°ndar ROCCC, es decir, que sean:

Reliable (Fiables), Original (Originales), Comprehensive (Completos), Current (Actuales) y Cited (Citados)

**Datos usados**
Per√≠odo: junio 2024 ‚Äì junio 2025
Total de viajes registrados: 5.628.847
Formato: .csv
Fuente: Motivate International Inc. (operadora de Divvy)
Licencia: Datos abiertos, anonimizados, sin informaci√≥n personal identificable

**Estructura de datos**

Cada fila representa un viaje e incluye:


* ride_id: Identificador √∫nico recorrido realizado
* rideable_type: Tipo de veh√≠culo (bicicleta cl√°sica, bicicleta el√©ctrica o scooter el√©ctrico)
* started_at y ended_at: Fecha y hora en las que inicia y finaliza el recorrido
* start_station_name / start_station_id	: Nombre e ID de estaci√≥n
* inicial end_station_name / end_station_id: Nombre e ID de la estaci√≥n final
* start_lat / start_lng: Coordenadas geogr√°ficas de inicio
* end_lat / end_lng: Coordenadas geogr√°ficas finales
* member_casual: Tipo de usuario, puedes ser miembro o casual

**Consideraciones √©ticas:**
Los datos est√°n anonimizados y no contienen informaci√≥n personal.

Cumplen con las pol√≠ticas de privacidad y uso de datos del proveedor.


**Verificaci√≥n de calidad:**
Se revis√≥ la integridad de los datos usando herramientas de R:

Valores nulos:
29.7% de los registros no tienen estaci√≥n de inicio ‚Üí Se separaron para an√°lisis opcional

IDs duplicados: No se encontraron

Tipos de veh√≠culo: 3 tipos v√°lidos (classic, electric, scooter)


Usuarios: Solo "member" y "casual"


Fechas inv√°lidas / viajes negativos: Eliminados
<!-- #endregion -->

<!-- #region -->
# Fase: Process

**Herramientas utilizadas**
Para el an√°lisis, transformaci√≥n y limpieza de los datos se utiliz√≥ R, un lenguaje de programaci√≥n especializado en an√°lisis estad√≠stico y visualizaci√≥n de datos.

**Entorno de trabajo: RStudio (Visual Studio + complemento de R)**

Librer√≠as clave:


* tidyverse para manipulaci√≥n y limpieza de datos
* lubridate para el manejo de fechas
* ggplot2 para visualizaci√≥n
* dplyr para filtrado y agrupaci√≥n de datos
* scales para mejorar la presentaci√≥n de gr√°ficos


El uso de R permiti√≥ trabajar con grandes vol√∫menes de datos, automatizar tareas de validaci√≥n y generar visualizaciones √∫tiles para el an√°lisis.

**Integridad de Datos**

Para asegurar que los datos sean fiables y √∫tiles para el an√°lisis, se realizaron varios pasos de limpieza y validaci√≥n:

<!-- #endregion -->

El primer paso ser√° cargar la base de datos

```{r}
library(tidyverse)
```

Ahora agregamos el dataset anualD
Este reune un a√±o de viajes en un solo archivo

```{r}
anualD <- read_csv("/kaggle/input/datos-originales/anualD.csv")
```

Pasos a seguir
1. Primeras verificaciones:

* Que los ID de viaje (ride_id) fueran √∫nicos
* Que existieran solo los tres tipos v√°lidos de veh√≠culos: classic_bike, electric_bike, y scooter.
* Que los usuarios solo estuvieran clasificados como casual o member

```{r}
# Verificar ID
sapply(anualD,n_distinct) #Contar√° lso datos dist√≠ntios de todas las entrada
nrow(anualD) # Nos dar√° el numero total de entradas en el dataset

# Con esto comprobamos que el n√∫mero de ride_id unicos son iguales a el n√∫mero total de entrada
# Por lo que no hay repeticiones en los ID

# Tambi√©n vemos que los rideable_type son solo 3 (classic_bike, electric_bike, y scooter)
# Y que solo hay 2 tipos de miembros (Casuales o miembros)
```

2. C√°lculo de duraci√≥n de viajes

Crearemos una nueva columna *duracion_minutos* para calcular la duraci√≥n del viaje.


```{r}
anualD <- anualD %>%
    mutate(duracion_minutos = as.numeric(difftime(ended_at, started_at, units = "mins")))


summary(anualD$duracion_minutos) #As√≠ podemos ver un resumen de la duraci√≥n de los viajes
```

Podemso ver que existen viajes *negativos* y de hasta *25horas*
Consideramos que esos son erorres en la base de datos y procederemos a eliminar esos registros

Pra realizar una limpieza profunda seg√∫n la duraci√≥n de los viajes
Vamos a: 

1. Eliminar viajes negativos
2. Eliminar viajes menores de 1 min o de m√°s de 90 min para tener

```{r}
# PASO 1: ELIMINAR NEGATIVOS

anualD <- anualD %>%
        filter(duracion_minutos >= 1)

# PASO 2: AJUSATAR DURACION DE VIAJES ENTRE 1 MIN Y 90 MIN

anualD <- anualD %>%
  filter(duracion_minutos >= 1, duracion_minutos <= 90)

summary(anualD$duracion_minutos)
```

Lo ultimo es eliminar los registros que est√°n incompletos

Primero comprobar lo que da problemas

```{r}
colSums(is.na(anualD))
```

As√≠ podemos ver todos los registros en blanco sobretodo en estaciones de inicio y estraciones finales de cada viaje.

No es totalmente necesario para el analisis en este caso, pero se tom√≥ la desici√≥n de solo trabajar con los datos entreros, por lo que vamos a eliminar el resto

```{r}
anualD <- anualD %>%
  filter(!is.na(start_station_name), !is.na(end_station_name))

colSums(is.na(anualD)) # Comprobaci√≥n final
```

# Fase: Analize

Aplicaremos m√©todos de an√°lisis descriptivo, incluyendo:

* Comparaci√≥n de miembros y usuarios casuales
* C√°lculo de medidas de tendencia central y dispersi√≥n en la duraci√≥n de viajes.
* Comparaci√≥n de patrones de uso por tipo de usuario (casual vs member)
* An√°lisis de comportamiento seg√∫n hora del d√≠a, d√≠a de la semana y mes.
* Visualizaci√≥n de resultados en gr√°ficos de barras y distribuciones comparativas.


```{r}
# Proporci√≥n miembros vs casuales

mix_usuarios <- anualD %>%
  group_by(member_casual) %>%
  summarise(conteo = n()) %>%
  mutate(porcentaje = round(conteo / sum(conteo) * 100, 1))
mix_usuarios
```

```{r}
mix_usuarios %>%
  mutate(etiqueta = paste0(member_casual, ": ", porcentaje, "%")) %>%
  ggplot(aes(x = "", y = conteo, fill = member_casual)) +
  geom_col(width = 1, color = "white") +
  coord_polar(theta = "y") +
  geom_text(aes(label = etiqueta), position = position_stack(vjust = 0.5),
            color = "white", size = 5) +
  labs(title = "Proporci√≥n de viajes por tipo de usuario") +
  scale_fill_manual(values = c("casual"="firebrick","member"="steelblue")) +
  theme_void() + theme(legend.position = "none")
```

```{r}
#Para facilitar el an√°lis, vamos a agregar hora de inicio, mes y dia de la semana

anualD <- anualD %>%
  mutate(
    hora_inicio = hour(started_at),
    dia_semana  = wday(started_at, label = TRUE, abbr = TRUE, week_start = 1), # Lu a Do
    mes         = month(started_at, label = TRUE, abbr = TRUE)
  )
```

```{r}
# 1 Duraci√≥n global
summary(anualD$duracion_minutos)

# 2 Duraci√≥n por tipo de usuario
anualD %>%
  group_by(member_casual) %>%
  summarise(
    promedio = mean(duracion_minutos),
    mediana  = median(duracion_minutos),
    maximo   = max(duracion_minutos),
    minimo   = min(duracion_minutos),
    conteo   = n()
  )
```

```{r}
anualD %>%
  group_by(member_casual) %>%
  summarise(promedio = mean(duracion_minutos)) %>%
  ggplot(aes(member_casual, promedio, fill = member_casual)) +
  geom_col(width = 0.6) +
  labs(title = "Duraci√≥n promedio por tipo de usuario", x = "", y = "Minutos") +
  scale_fill_manual(values = c("casual"="firebrick","member"="steelblue")) +
  theme(legend.position = "none")
```

Resultados:

* La media fue de 14 min y la mediana de 9.9 min.
* Los viajes suelen durar entre 6 y 17 minutos.
* Casuales ‚Üí viajes m√°s largos (media 18 min, mediana 12 min).
* Miembros ‚Üí viajes m√°s cortos y consistentes (media 11 min, mediana 8.7 min).
 
 üëâ Indica que los casuales usan la bici con fines recreativos/tur√≠sticos, mientras que los miembros lo hacen en trayectos diarios.


```{r}
# 3 Viajes por hora
viajes_hora <- anualD %>%
  group_by(member_casual, hora_inicio) %>%
  summarise(conteo = n(), .groups = "drop")
```

```{r}
#Graficamos los resultados

ggplot(viajes_hora, aes(hora_inicio, conteo, fill = member_casual)) +
  geom_col(position = "dodge") +
  labs(title="N√∫mero de viajes por hora del d√≠a", x="Hora", y="Viajes") +
  scale_fill_manual(values = c("casual"="firebrick","member"="steelblue"))
```

Los miembros concentran viajes en horas laborales: 7‚Äì9h y 16‚Äì19h.

Casuales muestran actividad m√°s dispersa, incluso de madrugada, con viajes m√°s largos (17‚Äì20 min en horas centrales del d√≠a).
 üëâ Confirma el patr√≥n de transporte laboral vs ocio.


```{r}
# 4 Viajes por d√≠a de la semana
viajes_dia <- anualD %>%
  group_by(member_casual, dia_semana) %>%
  summarise(conteo = n(), .groups = "drop")
```

```{r}
ggplot(viajes_dia, aes(dia_semana, conteo, fill = member_casual)) +
  geom_col(position = "dodge") +
  labs(title="N√∫mero de viajes por d√≠a de la semana", x="", y="Viajes") +
  scale_fill_manual(values = c("casual"="firebrick","member"="steelblue"))
```

Casuales ‚Üí fuertes los fines de semana, sobre todo s√°bados.
Miembros ‚Üí uso elevado y constante de lunes a viernes, que se mantiene tambi√©n en fines de semana.

Esto refuerza la diferencia entre un segmento recreativo y otro cotidiano.


```{r}
# 5 Viajes por mes
viajes_mes <- anualD %>%
  group_by(member_casual, mes) %>%
  summarise(conteo = n(), .groups = "drop")
```

```{r}
ggplot(viajes_mes, aes(mes, conteo, fill = member_casual)) +
  geom_col(position = "dodge") +
  labs(title="N√∫mero de viajes por mes", x="", y="Viajes") +
  scale_fill_manual(values = c("casual"="firebrick","member"="steelblue"))
```

Casuales ‚Üí comportamiento altamente estacional, con picos en verano (mayo‚Äìseptiembre) y ca√≠das en invierno.

Miembros ‚Üí uso estable todo el a√±o, aunque tambi√©n con mayor actividad en verano.

Evidencia que los casuales dependen m√°s de la temporada, mientras que los miembros son un flujo constante de ingresos.

